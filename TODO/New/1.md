
# 🧩 Function Extension / Improve

### ⏳ Todo

- [ ] **提前**存在于场景中的友方dwelling和仓库需要添加unique id以此来确保升级后的city task可以被正确添加
- [ ] 等待界面添加：要有天色变化；等待时玩家随时可以暂停；等待时不可以进行其他操作；等待时subgameplay的卡顿要处理掉；等待完毕后，
  从maingameplay进入subgameplay后要在玩家视野外提前运行几帧逻辑以避免大量士兵、建筑凭空出现。
- [ ] 保存并记录相机的位置，下次加载时，无论从subworld返回main world还是直接进入main world都要正确
- [ ] 修改buff系统：对于独立逻辑的buff，可以通过component+system处理；对于仅仅修改bonus的buff需要统一处理
- [ ] UI button优化：让指定button scale，让指定button color tint
- [ ] 存档和读档系统优化
- [ ] 天气系统
- [ ] 军团成长系统：每有一个其中的士兵获得经验，军团获得经验。如果所有军团士兵在一场战斗中死亡，则军团解散。
- [ ] 扩展slider功能：自动检测有效slot个数并根据个数确定最多划到哪里
- [ ] 召唤建筑更改：升级提升的是召唤速度和士兵数值，一级召唤门就可以召唤3级的建筑
- [ ] 自动保存功能

### ✅ Done


---

# 🐞 Bugs / Fix

### ⏳ Todo 

#### Critical bugs
- [ ] 有的时候，升级dwelling会导致人口容量异常。比如，当前人口3（+0）/5，升级dwelling 2->4，正常人口容量应该变成3（+0）/7，但是，有时会变成3（+0）/11或者3（+0）/15，不知道为什么
- [ ] 在subgameplay中等待军队garrison到该城市后，armygroup中的units并没有出现。只有退出city然后重新进入才会出现，因为需要load subgame data
- [ ] Heal 功能出错，不知道为什么，aoe target里只有cleric自己，没有shield。而且cleric攻击范围无线
- [ ] Dwelling cannot be attacked
#### Not critical bugs
- [ ] 

### ✅ Done
- [x]

---

# 🧪 Test

### ⏳ Todo
- [ ] 正在建造中的建筑是否会进入攻击姿态；是否可以被当作目标攻击
- [ ] 建筑摧毁逻辑：正在建筑中的dwelling/仓库被摧毁后的反应；正在召唤的建筑被摧毁后的反应；正在生产的建筑被摧毁后的反应
- [ ] 测试hold on功能
- [ ] 当一个军团的目标为invade，但它半路触发遭遇战后，会发生是什么？应该发生什么？city invader是否被正确处理
### ✅ Done
- [x] dwelling升级后，容量显示是否会出错，升级摧毁的storage改变是否做了特别处理:目前不会出错




